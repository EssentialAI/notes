
<!DOCTYPE html>

<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>A/B/n testing using online advertising scenario &#8212; Notes @ The Essential AI</title>
    
  <!-- Loaded before other Sphinx assets -->
  <link href="../_static/styles/theme.css?digest=1999514e3f237ded88cf" rel="stylesheet">
<link href="../_static/styles/pydata-sphinx-theme.css?digest=1999514e3f237ded88cf" rel="stylesheet">

    
  <link rel="stylesheet"
    href="../_static/vendor/fontawesome/5.13.0/css/all.min.css">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="../_static/vendor/fontawesome/5.13.0/webfonts/fa-solid-900.woff2">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="../_static/vendor/fontawesome/5.13.0/webfonts/fa-brands-400.woff2">

    <link rel="stylesheet" type="text/css" href="../_static/pygments.css" />
    <link rel="stylesheet" href="../_static/styles/sphinx-book-theme.css?digest=5115cc725059bd94278eecd172e13a965bf8f5a9" type="text/css" />
    <link rel="stylesheet" type="text/css" href="../_static/togglebutton.css" />
    <link rel="stylesheet" type="text/css" href="../_static/copybutton.css" />
    <link rel="stylesheet" type="text/css" href="../_static/mystnb.css" />
    <link rel="stylesheet" type="text/css" href="../_static/sphinx-thebe.css" />
    <link rel="stylesheet" type="text/css" href="../_static/custom.css" />
    <link rel="stylesheet" type="text/css" href="../_static/design-style.b7bb847fb20b106c3d81b95245e65545.min.css" />
    
  <!-- Pre-loaded scripts that we'll load fully later -->
  <link rel="preload" as="script" href="../_static/scripts/pydata-sphinx-theme.js?digest=1999514e3f237ded88cf">

    <script data-url_root="../" id="documentation_options" src="../_static/documentation_options.js"></script>
    <script src="../_static/jquery.js"></script>
    <script src="../_static/underscore.js"></script>
    <script src="../_static/doctools.js"></script>
    <script src="../_static/togglebutton.js"></script>
    <script src="../_static/clipboard.min.js"></script>
    <script src="../_static/copybutton.js"></script>
    <script src="../_static/scripts/sphinx-book-theme.js?digest=9c920249402e914e316237a7dbc6769907cce411"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown, .tag_hide_input div.cell_input, .tag_hide-input div.cell_input, .tag_hide_output div.cell_output, .tag_hide-output div.cell_output, .tag_hide_cell.cell, .tag_hide-cell.cell';</script>
    <script src="../_static/design-tabs.js"></script>
    <script>const THEBE_JS_URL = "https://unpkg.com/thebe@0.8.2/lib/index.js"
const thebe_selector = ".thebe,.cell"
const thebe_selector_input = "pre"
const thebe_selector_output = ".output, .cell_output"
</script>
    <script async="async" src="../_static/sphinx-thebe.js"></script>
    <script>window.MathJax = {"options": {"processHtmlClass": "tex2jax_process|mathjax_process|math|output_area"}}</script>
    <script defer="defer" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <link rel="canonical" href="https://essentialai.github.io/essentialai.github.io/reinforcement-learning/ab-testing.html" />
    <link rel="shortcut icon" href="../_static/brain1.ico"/>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="Epsilon Greedy explained" href="epsilon-greedy.html" />
    <link rel="prev" title="Coding a simple (random) Multi-Armed Bandit Agent" href="mab-code.html" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta name="docsearch:language" content="None">
    

    <!-- Google Analytics -->
    
  </head>
  <body data-spy="scroll" data-target="#bd-toc-nav" data-offset="60">
<!-- Checkboxes to toggle the left sidebar -->
<input type="checkbox" class="sidebar-toggle" name="__navigation" id="__navigation" aria-label="Toggle navigation sidebar">
<label class="overlay overlay-navbar" for="__navigation">
    <div class="visually-hidden">Toggle navigation sidebar</div>
</label>
<!-- Checkboxes to toggle the in-page toc -->
<input type="checkbox" class="sidebar-toggle" name="__page-toc" id="__page-toc" aria-label="Toggle in-page Table of Contents">
<label class="overlay overlay-pagetoc" for="__page-toc">
    <div class="visually-hidden">Toggle in-page Table of Contents</div>
</label>
<!-- Headers at the top -->
<div class="announcement header-item noprint"></div>
<div class="header header-item noprint"></div>

    
    <div class="container-fluid" id="banner"></div>

    

    <div class="container-xl">
      <div class="row">
          
<!-- Sidebar -->
<div class="bd-sidebar noprint" id="site-navigation">
    <div class="bd-sidebar__content">
        <div class="bd-sidebar__top"><div class="navbar-brand-box">
    <a class="navbar-brand text-wrap" href="../index.html">
      
        <!-- `logo` is deprecated in Sphinx 4.0, so remove this when we stop supporting 3 -->
        
      
      
      <img src="../_static/lightmode.svg" class="logo" alt="logo">
      
      
      <h1 class="site-logo" id="site-title">Notes @ The Essential AI</h1>
      
    </a>
</div><form class="bd-search d-flex align-items-center" action="../search.html" method="get">
  <i class="icon fas fa-search"></i>
  <input type="search" class="form-control" name="q" id="search-input" placeholder="Search this book..." aria-label="Search this book..." autocomplete="off" >
</form><nav class="bd-links" id="bd-docs-nav" aria-label="Main">
    <div class="bd-toc-item active">
        
        <ul class="nav bd-sidenav bd-sidenav__home-link">
            <li class="toctree-l1">
                <a class="reference internal" href="../intro.html">
                    Welcome to Notes @ Essential AI
                </a>
            </li>
        </ul>
        <ul class="current nav bd-sidenav">
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="../cvip/intro.html">
   Computer Vision and Image Processing
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-1" name="toctree-checkbox-1" type="checkbox"/>
  <label for="toctree-checkbox-1">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2">
    <a class="reference internal" href="../cvip/pinhole.html">
     Introduction and the Pinhole camera
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../cvip/CVIP_Project1.html">
     CVIP-project-1
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../cvip/image-transformations.html">
     Image Transformations
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../cvip/image-formation.html">
     Image Formation and Stereo Vision
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../cvip/image-rectification.html">
     How to rectify two cameras?
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../cvip/image-features.html">
     Image Features and Matching
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../cvip/using-scale-as-feature.html">
     Using scale as a feature for correspondence
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../cvip/feature-matching.html">
     Feature Matching
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../cvip/image-filtering.html">
     Image Filtering
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../cvip/image-fourier-analysis.html">
     Image Fourier Analysis
    </a>
   </li>
  </ul>
 </li>
 <li class="toctree-l1 current active has-children">
  <a class="reference internal" href="intro.html">
   Reinforcement Learning
  </a>
  <input checked="" class="toctree-checkbox" id="toctree-checkbox-2" name="toctree-checkbox-2" type="checkbox"/>
  <label for="toctree-checkbox-2">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul class="current">
   <li class="toctree-l2">
    <a class="reference internal" href="mab.html">
     The Multi-Armed Bandit problem
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="mab-code.html">
     Coding a simple (random) Multi-Armed Bandit Agent
    </a>
   </li>
   <li class="toctree-l2 current active">
    <a class="current reference internal" href="#">
     A/B/n testing using online advertising scenario
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="epsilon-greedy.html">
     Epsilon Greedy explained
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="optimistic-initial-values.html">
     Optimistic initial values
    </a>
   </li>
  </ul>
 </li>
</ul>

    </div>
</nav></div>
        <div class="bd-sidebar__bottom">
             <!-- To handle the deprecated key -->
            
            <div class="navbar_extra_footer">
            Powered by <a href="https://jupyterbook.org">Jupyter Book</a>
            </div>
            
        </div>
    </div>
    <div id="rtd-footer-container"></div>
</div>


          


          
<!-- A tiny helper pixel to detect if we've scrolled -->
<div class="sbt-scroll-pixel-helper"></div>
<!-- Main content -->
<div class="col py-0 content-container">
    
    <div class="header-article row sticky-top noprint">
        



<div class="col py-1 d-flex header-article-main">
    <div class="header-article__left">
        
        <label for="__navigation"
  class="headerbtn"
  data-toggle="tooltip"
data-placement="right"
title="Toggle navigation"
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-bars"></i>
  </span>

</label>

        
    </div>
    <div class="header-article__right">
<div class="menu-dropdown menu-dropdown-launch-buttons">
  <button class="headerbtn menu-dropdown__trigger"
      aria-label="Launch interactive content">
      <i class="fas fa-rocket"></i>
  </button>
  <div class="menu-dropdown__content">
    <ul>
      <li>
        <a href="https://mybinder.org/v2/gh/EssentialAI/notes/main?urlpath=tree/reinforcement-learning/ab-testing.ipynb"
   class="headerbtn"
   data-toggle="tooltip"
data-placement="left"
title="Launch on Binder"
>
  

<span class="headerbtn__icon-container">
  
    <img src="../_static/images/logo_binder.svg">
  </span>
<span class="headerbtn__text-container">Binder</span>
</a>

      </li>
      
      <li>
        
<button onclick="initThebeSBT()"
  class="headerbtn headerbtn-launch-thebe"
  data-toggle="tooltip"
data-placement="left"
title="Launch Thebe"
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-play"></i>
  </span>
<span class="headerbtn__text-container">Live Code</span>
</button>

      </li>
      
    </ul>
  </div>
</div>

<button onclick="toggleFullScreen()"
  class="headerbtn"
  data-toggle="tooltip"
data-placement="bottom"
title="Fullscreen mode"
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-expand"></i>
  </span>

</button>

<div class="menu-dropdown menu-dropdown-download-buttons">
  <button class="headerbtn menu-dropdown__trigger"
      aria-label="Download this page">
      <i class="fas fa-download"></i>
  </button>
  <div class="menu-dropdown__content">
    <ul>
      <li>
        <a href="../_sources/reinforcement-learning/ab-testing.ipynb"
   class="headerbtn"
   data-toggle="tooltip"
data-placement="left"
title="Download source file"
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-file"></i>
  </span>
<span class="headerbtn__text-container">.ipynb</span>
</a>

      </li>
      
      <li>
        
<button onclick="printPdf(this)"
  class="headerbtn"
  data-toggle="tooltip"
data-placement="left"
title="Print to PDF"
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-file-pdf"></i>
  </span>
<span class="headerbtn__text-container">.pdf</span>
</button>

      </li>
      
    </ul>
  </div>
</div>
<label for="__page-toc"
  class="headerbtn headerbtn-page-toc"
  
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-list"></i>
  </span>

</label>

    </div>
</div>

<!-- Table of contents -->
<div class="col-md-3 bd-toc show noprint">
    <div class="tocsection onthispage pt-5 pb-3">
        <i class="fas fa-list"></i> Contents
    </div>
    <nav id="bd-toc-nav" aria-label="Page">
        <ul class="visible nav section-nav flex-column">
 <li class="toc-h1 nav-item toc-entry">
  <a class="reference internal nav-link" href="#">
   A/B/n testing using online advertising scenario
  </a>
 </li>
 <li class="toc-h1 nav-item toc-entry">
  <a class="reference internal nav-link" href="#a-b-n-testing">
   A/B/n testing
  </a>
  <ul class="visible nav section-nav flex-column">
   <li class="toc-h2 nav-item toc-entry">
    <a class="reference internal nav-link" href="#notation">
     Notation
    </a>
   </li>
   <li class="toc-h2 nav-item toc-entry">
    <a class="reference internal nav-link" href="#application-to-the-online-advertising-scenario">
     Application to the online advertising scenario
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h1 nav-item toc-entry">
  <a class="reference internal nav-link" href="#advantages-and-disadvantages-of-a-b-n-testing">
   Advantages and disadvantages of A/B/n testing
  </a>
 </li>
 <li class="toc-h1 nav-item toc-entry">
  <a class="reference internal nav-link" href="#references">
   References
  </a>
 </li>
</ul>

    </nav>
</div>
    </div>
    <div class="article row">
        <div class="col pl-md-3 pl-lg-5 content-container">
            <!-- Table of contents that is only displayed when printing the page -->
            <div id="jb-print-docs-body" class="onlyprint">
                <h1>A/B/n testing using online advertising scenario</h1>
                <!-- Table of contents -->
                <div id="print-main-content">
                    <div id="jb-print-toc">
                        
                        <div>
                            <h2> Contents </h2>
                        </div>
                        <nav aria-label="Page">
                            <ul class="visible nav section-nav flex-column">
 <li class="toc-h1 nav-item toc-entry">
  <a class="reference internal nav-link" href="#">
   A/B/n testing using online advertising scenario
  </a>
 </li>
 <li class="toc-h1 nav-item toc-entry">
  <a class="reference internal nav-link" href="#a-b-n-testing">
   A/B/n testing
  </a>
  <ul class="visible nav section-nav flex-column">
   <li class="toc-h2 nav-item toc-entry">
    <a class="reference internal nav-link" href="#notation">
     Notation
    </a>
   </li>
   <li class="toc-h2 nav-item toc-entry">
    <a class="reference internal nav-link" href="#application-to-the-online-advertising-scenario">
     Application to the online advertising scenario
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h1 nav-item toc-entry">
  <a class="reference internal nav-link" href="#advantages-and-disadvantages-of-a-b-n-testing">
   Advantages and disadvantages of A/B/n testing
  </a>
 </li>
 <li class="toc-h1 nav-item toc-entry">
  <a class="reference internal nav-link" href="#references">
   References
  </a>
 </li>
</ul>

                        </nav>
                    </div>
                </div>
            </div>
            <main id="main-content" role="main">
                
              <div>
                
  <div class="tex2jax_ignore mathjax_ignore section" id="a-b-n-testing-using-online-advertising-scenario">
<h1>A/B/n testing using online advertising scenario<a class="headerlink" href="#a-b-n-testing-using-online-advertising-scenario" title="Permalink to this headline">#</a></h1>
<p>Consider a company that wants to advertise a product on various websites through digital banners, aiming to attract visitors to the product landing page. Among multiple alternatives, the advertiser company wants to find out which banner is the most effective and has the maximum <strong>click-through rate (CTR)</strong>, which is defined as the total number of clicks an ad receives divided by the total number of impressions (number of times it is shown).</p>
<p>Every time a banner is about to be shown on a website, it is the advertiser’s algorithm that chooses the banner (for example, through an API provided by the advertiser to the website) and observes whether the impression has resulted in a click or not. This is a great use case for a MAB model, which could boost clicks and product sales. What we want the MAB model to do is toidentify the ad that performs the best as early as possible, display it more, and write off the ad(s) that is (are) a clear loser(s) as early as possible.</p>
<div class="admonition tip">
<p class="admonition-title">Tip</p>
<p>The probability of observing a click or no click after an impression, a binary outcome, can be modeled using the Bernoulli distribution. It has a single parameter, , which is the probability of receiving a click, or more generally, observing a 1 as opposed to a 0. Note that this is a discrete probability distribution, whereas the normal distribution we used earlier is a continuous one.</p>
</div>
<p>In the <a class="reference internal" href="mab-code.html"><span class="doc std std-doc">previous page</span></a>, we had rewards coming from a normal (Gaussian) distribution. In the online ad case, we have a binary outcome. For each ad version, there is a different probability of click (CTR), which the advertiser does not know but is trying to discover. So, the rewards will come from different <strong>Bernoulli distributions</strong> for each ad. Let’s code these to use with our algorithms later:</p>
<p><strong>1. We start by creating a class to model the ad behavior:</strong></p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>

<span class="k">class</span> <span class="nc">BernoulliBandit</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">p</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">p</span> <span class="o">=</span> <span class="n">p</span>
    
    <span class="k">def</span> <span class="nf">display_ad</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">reward</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">binomial</span><span class="p">(</span><span class="n">n</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">p</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">p</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">reward</span>
</pre></div>
</div>
</div>
</div>
<p><strong>2. Now, let’s create five different ads (banners) with the corresponding CTRs we arbitrarily pick:</strong></p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">adA</span> <span class="o">=</span> <span class="n">BernoulliBandit</span><span class="p">(</span><span class="mf">0.004</span><span class="p">)</span>
<span class="n">adB</span> <span class="o">=</span> <span class="n">BernoulliBandit</span><span class="p">(</span><span class="mf">0.016</span><span class="p">)</span>
<span class="n">adC</span> <span class="o">=</span> <span class="n">BernoulliBandit</span><span class="p">(</span><span class="mf">0.02</span><span class="p">)</span>
<span class="n">adD</span> <span class="o">=</span> <span class="n">BernoulliBandit</span><span class="p">(</span><span class="mf">0.028</span><span class="p">)</span>
<span class="n">adE</span> <span class="o">=</span> <span class="n">BernoulliBandit</span><span class="p">(</span><span class="mf">0.031</span><span class="p">)</span>

<span class="n">ads</span> <span class="o">=</span> <span class="p">[</span><span class="n">adA</span><span class="p">,</span> <span class="n">adB</span><span class="p">,</span> <span class="n">adC</span><span class="p">,</span> <span class="n">adD</span><span class="p">,</span> <span class="n">adE</span><span class="p">]</span>
</pre></div>
</div>
</div>
</div>
<p>Let’s code exploration strategy for the above ads and try to estimate the probabilities of reward for each online ad.</p>
</div>
<div class="tex2jax_ignore mathjax_ignore section" id="a-b-n-testing">
<h1>A/B/n testing<a class="headerlink" href="#a-b-n-testing" title="Permalink to this headline">#</a></h1>
<p>One of the most common exploration strategies is what is called A/B testing, which is a method to determine which one of the two alternatives (of online products, pages, ads, and so on) performs better. In this type of testing, the users are randomly split into two groups to try different alternatives. At the end of the testing period, the results are compared to choose the best alternative, which is then used in production for the rest of the problem horizon. In our case, we have more than two ad versions. So, we will implement what is called A/B/n testing.</p>
<p>We will use A/B/n testing as our baseline strategy for comparison with the more advanced methods that we will introduce afterward. Before going into the implementation, we need to define some notation that we will use throughout the chapter.</p>
<div class="section" id="notation">
<h2>Notation<a class="headerlink" href="#notation" title="Permalink to this headline">#</a></h2>
<p>Throughout the implementations of various algorithms, we will need to keep track of some quantities related to a particular action (the ad chosen for display), <span class="math notranslate nohighlight">\(a\)</span>. Now, we define some notation for those quantities. Initially, we drop <span class="math notranslate nohighlight">\(a\)</span> from our notation for brevity, but at the end of this section, we will put it back:</p>
<ul class="simple">
<li><p>First, we denote the reward (that is, 1 for a click, 0 for no click) received after selecting the action, <span class="math notranslate nohighlight">\(a\)</span>, for the <span class="math notranslate nohighlight">\(i^{th}\)</span> time by <span class="math notranslate nohighlight">\(R_i\)</span>.</p></li>
<li><p>The average reward observed before the <span class="math notranslate nohighlight">\(n^{th}\)</span> selection of this same action is defined as follows:</p></li>
</ul>
<div class="math notranslate nohighlight">
\[Q_n = \frac{R_1 + R_2 + R_3 + ... + R_{n-1}}{n-1}\]</div>
<p>This estimates the expected value of the reward that this action yields, <span class="math notranslate nohighlight">\(R\)</span>, after <span class="math notranslate nohighlight">\(n-1\)</span> observations.</p>
<ul class="simple">
<li><p>This is also called the <strong>action value</strong> of <span class="math notranslate nohighlight">\(a\)</span>. Here, <span class="math notranslate nohighlight">\(Q_n\)</span> estimates of the action value after selecting this action <span class="math notranslate nohighlight">\(n-1\)</span> times.</p></li>
<li><p>Using simple algebra we can modify the above formula for <span class="math notranslate nohighlight">\(Q_n\)</span> into a more convenient form.</p></li>
</ul>
<div class="math notranslate nohighlight">
\[\begin{split}\begin{align}
Q_{n+1} &amp;= \frac{R_1 + R_2 + R_3 + ... + R_{n}}{n} \\
&amp;= \frac{R_1 + R_2 + R_3 + ... + R_{n-1}}{n-1} + \frac{R_n}{n} \\
&amp;= \frac{n-1}{n}\cdot Q_n + \frac{R_n}{n} \\
&amp;= Q_n + \frac{1}{n}\cdot (R_n-Q_n)
\end{align}\end{split}\]</div>
<ul class="simple">
<li><p>Remember that <span class="math notranslate nohighlight">\(Q_n\)</span> is our estimate for the action value of <span class="math notranslate nohighlight">\(a\)</span> before we take it for the <span class="math notranslate nohighlight">\(n^{th}\)</span> time. When we observe the reward, <span class="math notranslate nohighlight">\(R_n\)</span>, it gives us another signal for the action value. We don’t want to discard our previous observations, but we also want to update our estimate to reflect the new signal.</p></li>
<li><p>This means, we adjust our current estimate, <span class="math notranslate nohighlight">\(Q_n\)</span>, in the direction of the <strong>error</strong> that we calculate based on the latest observed reward, <span class="math notranslate nohighlight">\(R_n - Q_n\)</span>, with a <strong>step size</strong> of <span class="math notranslate nohighlight">\(1/n\)</span> and obtain a new estimate, <span class="math notranslate nohighlight">\(Q_{n+1}\)</span>. This means, for example, if the latest observed reward is greater than our current estimate, we revise the action value estimate upward.</p></li>
<li><p>For convenience, we define <span class="math notranslate nohighlight">\(Q_0 = 0\)</span>.</p></li>
<li><p>Notice that the rate at which we adjust our estimate will get smaller as we make more observations due to the <span class="math notranslate nohighlight">\(1/n\)</span> term. So, we put less weight on the most recent observations and our estimate for the action value for a particular action will settle down over time.</p></li>
<li><p>However, this might be a disadvantage if the environment is not stationary but is changing over time. In those cases, we would want to use a step size that does not diminish over time, such as a fixed step size of <span class="math notranslate nohighlight">\(\alpha \in (0,1)\)</span>.</p></li>
<li><p>Note that this step size must be smaller than 1 for the estimate to converge (and larger than 0 for a proper update).</p></li>
<li><p>Using a fixed value for <span class="math notranslate nohighlight">\(\alpha\)</span> will make the weights of the older observations decrease exponentially as we take action <span class="math notranslate nohighlight">\(\alpha\)</span> more and more.</p></li>
</ul>
<p>Let’s bring <span class="math notranslate nohighlight">\(\alpha\)</span> back to the notation, so we can obtain our formula to update the action values:</p>
<div class="math notranslate nohighlight">
\[
Q_{n+1}(a) = Q_n(a) + \alpha (R_n(\alpha) - Q_n(a))
\]</div>
<p>Here, is a number between 0 and 1. For stationary problems, we usually set <span class="math notranslate nohighlight">\(\alpha = 1/N(a)\)</span>, where <span class="math notranslate nohighlight">\(N(a)\)</span> is the number of times the action <span class="math notranslate nohighlight">\(a\)</span> has been taken up to that point (which was denoted by <span class="math notranslate nohighlight">\(n\)</span> initially). In stationary problems, this will help action values converge quicker, due to the diminishing <span class="math notranslate nohighlight">\(1/N(a)\)</span> term, rather than chasing after noisy observations.</p>
<p>That’s all we need. Without further ado, let’s implement an A/B/n test.</p>
</div>
<div class="section" id="application-to-the-online-advertising-scenario">
<h2>Application to the online advertising scenario<a class="headerlink" href="#application-to-the-online-advertising-scenario" title="Permalink to this headline">#</a></h2>
<p>In our example, we have five different ad versions, which we randomly show to the users with equal probabilities. Let’s implement this in Python:</p>
<p><strong>1. We start with creating the variables to keep track of the rewards in the experiment:</strong></p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">n_test</span> <span class="o">=</span> <span class="mi">10000</span>
<span class="n">n_prod</span> <span class="o">=</span> <span class="mi">90000</span>
<span class="n">n_ads</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">ads</span><span class="p">)</span>
<span class="n">Q</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">n_ads</span><span class="p">)</span>  <span class="c1"># Q, action values</span>
<span class="n">N</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">n_ads</span><span class="p">)</span>  <span class="c1"># N, total impressions</span>
<span class="n">total_reward</span> <span class="o">=</span> <span class="mi">0</span>
<span class="n">avg_rewards</span> <span class="o">=</span> <span class="p">[]</span>  <span class="c1"># Save average rewards over time</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># A/B/n test</span>
<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">n_test</span><span class="p">):</span>
    <span class="n">ad_chosen</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">randint</span><span class="p">(</span><span class="n">n_ads</span><span class="p">)</span>
    <span class="n">R</span> <span class="o">=</span> <span class="n">ads</span><span class="p">[</span><span class="n">ad_chosen</span><span class="p">]</span><span class="o">.</span><span class="n">display_ad</span><span class="p">()</span>  <span class="c1"># Observe reward</span>
    <span class="n">N</span><span class="p">[</span><span class="n">ad_chosen</span><span class="p">]</span> <span class="o">+=</span> <span class="mi">1</span>
    <span class="n">Q</span><span class="p">[</span><span class="n">ad_chosen</span><span class="p">]</span> <span class="o">+=</span> <span class="p">(</span><span class="mi">1</span> <span class="o">/</span> <span class="n">N</span><span class="p">[</span><span class="n">ad_chosen</span><span class="p">])</span> <span class="o">*</span> <span class="p">(</span><span class="n">R</span> <span class="o">-</span> <span class="n">Q</span><span class="p">[</span><span class="n">ad_chosen</span><span class="p">])</span>
    <span class="n">total_reward</span> <span class="o">+=</span> <span class="n">R</span>
    <span class="n">avg_reward_so_far</span> <span class="o">=</span> <span class="n">total_reward</span> <span class="o">/</span> <span class="p">(</span><span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>
    <span class="n">avg_rewards</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">avg_reward_so_far</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">best_ad_index</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">argmax</span><span class="p">(</span><span class="n">Q</span><span class="p">)</span>  <span class="c1"># Find the best action</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;The best performing ad is </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="nb">chr</span><span class="p">(</span><span class="nb">ord</span><span class="p">(</span><span class="s1">&#39;A&#39;</span><span class="p">)</span> <span class="o">+</span> <span class="n">best_ad_index</span><span class="p">)))</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>The best performing ad is D
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">ad_chosen</span> <span class="o">=</span> <span class="n">best_ad_index</span>
<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">n_prod</span><span class="p">):</span>
    <span class="n">R</span> <span class="o">=</span> <span class="n">ads</span><span class="p">[</span><span class="n">ad_chosen</span><span class="p">]</span><span class="o">.</span><span class="n">display_ad</span><span class="p">()</span>
    <span class="n">total_reward</span> <span class="o">+=</span> <span class="n">R</span>
    <span class="n">avg_reward_so_far</span> <span class="o">=</span> <span class="n">total_reward</span> <span class="o">/</span> <span class="p">(</span><span class="n">n_test</span> <span class="o">+</span> <span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>
    <span class="n">avg_rewards</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">avg_reward_so_far</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">df_reward_comparison</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">avg_rewards</span><span class="p">,</span> <span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;A/B/n&#39;</span><span class="p">])</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">df_reward_comparison</span><span class="p">[</span><span class="s1">&#39;A/B/n&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">title</span><span class="o">=</span><span class="s2">&quot;A/B/n Test Avg. Reward: </span><span class="si">{:.4f}</span><span class="s2">&quot;</span>
                                    <span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">avg_reward_so_far</span><span class="p">))</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s2">&quot;Impressions&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s2">&quot;Avg. Reward&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../_images/ab-testing_12_01.png" src="../_images/ab-testing_12_01.png" />
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="n">Q</span><span class="p">)</span>

<span class="c1"># Actual probabilities of rewards</span>
<span class="c1"># adA = BernoulliBandit(0.004)</span>
<span class="c1"># adB = BernoulliBandit(0.016)</span>
<span class="c1"># adC = BernoulliBandit(0.02)</span>
<span class="c1"># adD = BernoulliBandit(0.028)</span>
<span class="c1"># adE = BernoulliBandit(0.031)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[0.00557527 0.01866801 0.0165     0.02848576 0.02250489]
</pre></div>
</div>
</div>
</div>
<p>The model explores for the first 10000 steps. Once the estimated rewards for each ad are updated, the model picks the ad with highest estimated probability is shown for the next 90000 impressions to receive reward.</p>
<p>It can be seen that the overall average reward for all the impressions converges with the actual reward for the add E</p>
</div>
</div>
<div class="tex2jax_ignore mathjax_ignore section" id="advantages-and-disadvantages-of-a-b-n-testing">
<h1>Advantages and disadvantages of A/B/n testing<a class="headerlink" href="#advantages-and-disadvantages-of-a-b-n-testing" title="Permalink to this headline">#</a></h1>
<ul class="simple">
<li><p><strong>A/B/n testing is inefficient as it does not modify the experiment dynamically by learning from the observations</strong>. Instead, it explores in a fixed time budget with pre-determined probabilities of trying the alternatives. It fails to benefit from the early observations in the test by writing off/promoting an alternative even though it is obviously underperforming/outperforming the others.</p></li>
<li><p><strong>It is unable to correct a decision once it’s made</strong>. If, for some reason, the test period identifies an alternative as the best incorrectly (mostly because of a not-sufficiently long test duration), this selection remains fixed during the production period. So, there is no way to correct the decision for the rest of the deployment horizon.</p></li>
<li><p><strong>It is unable to adapt to changes in a dynamic environment</strong>. Related to the previous note, this approach is especially problematic for environments that are not stationary. So, if the underlying reward distributions change over time, plain A/B/n testing has no way of detecting such changes after the selection is fixed.</p></li>
<li><p><strong>The length of the test period is a hyperparameter to tune, affecting the efficiency of the test</strong>. If this period is chosen to be shorter than needed, an incorrect alternative could be declared the best because of the noise in the observations. If the test period is chosen to be too long, too much money gets wasted in exploration.</p></li>
<li><p><strong>A/B/n testing is simple</strong>. Despite all these shortcomings, it is intuitive and easy to implement, and therefore widely used in practice.</p></li>
</ul>
<p>So, the vanilla A/B/n testing is a rather naive approach to MAB. Next, let’s look into some other more advanced approaches that will overcome some of the shortcomings of A/B/n testing, starting with ε-greedy.</p>
</div>
<div class="tex2jax_ignore mathjax_ignore section" id="references">
<h1>References<a class="headerlink" href="#references" title="Permalink to this headline">#</a></h1>
<ul class="simple">
<li><p><a class="reference external" href="https://www.packtpub.com/product/mastering-reinforcement-learning-with-python/9781838644147">https://www.packtpub.com/product/mastering-reinforcement-learning-with-python/9781838644147</a></p></li>
</ul>
<p><em>This entire page is a chapter referenced from the above link. EssentialAI does not claim ownership of the content in any way.</em></p>
</div>

    <script type="text/x-thebe-config">
    {
        requestKernel: true,
        binderOptions: {
            repo: "EssentialAI/notes",
            ref: "main",
        },
        codeMirrorConfig: {
            theme: "abcdef",
            mode: "python"
        },
        kernelOptions: {
            kernelName: "python3",
            path: "./reinforcement-learning"
        },
        predefinedOutput: true
    }
    </script>
    <script>kernelName = 'python3'</script>

              </div>
              
            </main>
            <footer class="footer-article noprint">
                
    <!-- Previous / next buttons -->
<div class='prev-next-area'>
    <a class='left-prev' id="prev-link" href="mab-code.html" title="previous page">
        <i class="fas fa-angle-left"></i>
        <div class="prev-next-info">
            <p class="prev-next-subtitle">previous</p>
            <p class="prev-next-title">Coding a simple (random) Multi-Armed Bandit Agent</p>
        </div>
    </a>
    <a class='right-next' id="next-link" href="epsilon-greedy.html" title="next page">
    <div class="prev-next-info">
        <p class="prev-next-subtitle">next</p>
        <p class="prev-next-title">Epsilon Greedy explained</p>
    </div>
    <i class="fas fa-angle-right"></i>
    </a>
</div>
            </footer>
        </div>
    </div>
    <div class="footer-content row">
        <footer class="col footer"><p>
  
    By Naresh Kumar<br/>
  
      &copy; Copyright 2022.<br/>
</p>
        </footer>
    </div>
    
</div>


      </div>
    </div>
  
  <!-- Scripts loaded after <body> so the DOM is not blocked -->
  <script src="../_static/scripts/pydata-sphinx-theme.js?digest=1999514e3f237ded88cf"></script>


  </body>
</html>